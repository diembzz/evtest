import{u as O}from"./BRwSn9Ju.js";import{a as m,ay as y,r as v,af as j,a1 as R,ao as H,ap as K,J as M,a7 as C,az as b,L as N,a3 as x,aA as z,aB as E,aa as S,a4 as V}from"./BsQ1qeEF.js";const I=s=>s==="defer"||s===!1;function L(...s){var P;const r=typeof s[s.length-1]=="string"?s.pop():void 0;typeof s[0]!="string"&&s.unshift(r);let[e,c,a={}]=s;if(typeof e!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof c!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const t=m(),h=c,p=()=>y.value,l=()=>t.isHydrating?t.payload.data[e]:t.static.data[e];a.server=a.server??!0,a.default=a.default??p,a.getCachedData=a.getCachedData??l,a.lazy=a.lazy??!1,a.immediate=a.immediate??!0,a.deep=a.deep??y.deep,a.dedupe=a.dedupe??"cancel";const u=()=>a.getCachedData(e,t)!=null;if(!t._asyncData[e]||!a.immediate){(P=t.payload._errors)[e]??(P[e]=y.errorValue);const i=a.deep?v:j;t._asyncData[e]={data:i(a.getCachedData(e,t)??a.default()),pending:v(!u()),error:R(t.payload._errors,e),status:v("idle"),_default:a.default}}const n={...t._asyncData[e]};delete n._default,n.refresh=n.execute=(i={})=>{if(t._asyncDataPromises[e]){if(I(i.dedupe??a.dedupe))return t._asyncDataPromises[e];t._asyncDataPromises[e].cancelled=!0}if((i._initial||t.isHydrating&&i._initial!==!1)&&u())return Promise.resolve(a.getCachedData(e,t));n.pending.value=!0,n.status.value="pending";const d=new Promise((f,o)=>{try{f(h(t))}catch(D){o(D)}}).then(async f=>{if(d.cancelled)return t._asyncDataPromises[e];let o=f;a.transform&&(o=await a.transform(f)),a.pick&&(o=W(o,a.pick)),t.payload.data[e]=o,n.data.value=o,n.error.value=y.errorValue,n.status.value="success"}).catch(f=>{if(d.cancelled)return t._asyncDataPromises[e];n.error.value=b(f),n.data.value=N(a.default()),n.status.value="error"}).finally(()=>{d.cancelled||(n.pending.value=!1,delete t._asyncDataPromises[e])});return t._asyncDataPromises[e]=d,t._asyncDataPromises[e]},n.clear=()=>T(t,e);const _=()=>n.refresh({_initial:!0}),B=a.server!==!1&&t.payload.serverRendered;{const i=x();if(i&&!i._nuxtOnBeforeMountCbs){i._nuxtOnBeforeMountCbs=[];const o=i._nuxtOnBeforeMountCbs;H(()=>{o.forEach(D=>{D()}),o.splice(0,o.length)}),K(()=>o.splice(0,o.length))}B&&t.isHydrating&&(n.error.value||u())?(n.pending.value=!1,n.status.value=n.error.value?"error":"success"):i&&(t.payload.serverRendered&&t.isHydrating||a.lazy)&&a.immediate?i._nuxtOnBeforeMountCbs.push(_):a.immediate&&_();const d=z();if(a.watch){const o=M(a.watch,()=>n.refresh());d&&C(o)}const f=t.hook("app:data:refresh",async o=>{(!o||o.includes(e))&&await n.refresh()});d&&C(f)}const g=Promise.resolve(t._asyncDataPromises[e]).then(()=>n);return Object.assign(g,n),g}function T(s,r){r in s.payload.data&&(s.payload.data[r]=void 0),r in s.payload._errors&&(s.payload._errors[r]=y.errorValue),s._asyncData[r]&&(s._asyncData[r].data.value=void 0,s._asyncData[r].error.value=y.errorValue,s._asyncData[r].pending.value=!1,s._asyncData[r].status.value="idle"),r in s._asyncDataPromises&&(s._asyncDataPromises[r]&&(s._asyncDataPromises[r].cancelled=!0),s._asyncDataPromises[r]=void 0)}function W(s,r){const e={};for(const c of r)e[c]=s[c];return e}const w="__nuxt_component";async function $(s,r){const e=m(),c=E(),a=x(),{fetchKey:t,_fetchKeyBase:h}=a.proxy.$options,p=(typeof t=="function"?t(()=>""):t)||[h,c.fullPath,c.matched.findIndex(n=>Object.values(n.components||{}).includes(a.type))].join(":"),{data:l,error:u}=await L(`options:asyncdata:${p}`,()=>e.runWithContext(()=>r(e)));if(u.value)throw b(u.value);l.value&&typeof l.value=="object"&&Object.assign(await s,S(V(l.value)))}const U=function(...r){const[e,c]=r,{setup:a}=e;return!a&&!e.asyncData&&!e.head?{[w]:!0,...e}:{[w]:!0,_fetchKeyBase:c,...e,setup(t,h){const p=m(),l=a?Promise.resolve(p.runWithContext(()=>a(t,h))).then(n=>n||{}):{},u=[];if(e.asyncData&&u.push($(l,e.asyncData)),e.head){const n=m();O(typeof e.head=="function"?()=>e.head(n):e.head)}return Promise.resolve(l).then(()=>Promise.all(u)).then(()=>l).finally(()=>{u.length=0})}}};export{U as d};
